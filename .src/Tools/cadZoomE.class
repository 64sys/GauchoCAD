' Gambas class file

' Tool maintained by Terco
Inherits ToolsBase
Create Static
Public Const GENDER As String = ("ZoomE")


'  PanX y PanY estanen coordenadas de pantalla, o sea pixeles
'  por lo tanto algo que este en la posicion Px se dibujara en el pixel xPix = Px + PanX
'  si Px esta en coordenadas mundo, hay que reducirlo a pixels primero
'  PixPx = Pixels(Px) , entonces queda asi xPix = Pixels(Px) + PanX
'  Si quiero que eso quede en el centro de la pantalla xPix sera ViewportX/2, entonces


'  ViewportX/2 = Pixels(Px) + PanX , despejando PanX = ViewportX/2 - Pixels(Px)




Public Function Start(Optional ElemToBuild As Variant, Optional _Mode As Integer = 0) As Boolean

    
    If _mode <> 1 Then clsEntities.CalcularLimites
    
    If APPMain.hFCAD.arrEntities.Count = 0 Then Return
    
    
    Dim SZx As Float
    ' ahora calculo donde estaria el centro de este dibujo
    
    Dim cx, cy As Float
    Dim px, py As Integer           ' coordenadas del punto medio
    
    
  
    
    
    cx = (appmain.hFcad.xmayor - appmain.hFcad.xmenor) ' tama√±o del mundo
    cy = (appmain.hFcad.Ymayor - appmain.hFcad.Ymenor)
    
    If cx = 0 Then cx = 0.00001
    If cy = 0 Then cy = 0.00001
    appmain.hFcad.ScaleZoom = appmain.hFcad.glarea1.h / cy * 0.9

    szx = appmain.hFcad.glarea1.w / cx * 0.9

    If szx < appmain.hFcad.ScaleZoom Then appmain.hFcad.ScaleZoom = szx
    
    px = (appmain.hFcad.xmayor + appmain.hFcad.xmenor) / 2
    py = (appmain.hFcad.Ymayor + appmain.hFcad.Ymenor) / 2
        
    appmain.hFCAD.PanX = -appmain.hFcad.pixels(px)
    appmain.hFCAD.PanY = -appmain.hFcad.pixels(py)   ' el eje Y trabaja distinto, asi que debemos cambiar esto
    
    If appmain.hFcad.ScaleZoom > 1e6 Or appmain.hFcad.ScaleZoom < 1e-6 Then 
        appmain.hFcad.scalezoom = 1
        appmain.hFCAD.PanX = 0
        appmain.hFCAD.PanY = 0
    End If
    
    
    Me.Finish
    
    
End
